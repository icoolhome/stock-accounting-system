# 版本說明 - vS0002-1

## 版本信息
- **版本號**: vS0002-1
- **發布日期**: 2026-01-03

## 更新內容

### 性能優化

#### 數據庫索引優化
1. **查詢性能大幅提升**
   - 為所有主要數據表添加索引，大幅提升查詢性能
   - 添加 transactions 表索引（user_id, trade_date, stock_code, securities_account_id）
   - 添加 settlements 表索引（user_id, settlement_date, bank_account_id, transaction_id）
   - 添加 dividends 表索引（user_id, record_date, stock_code）
   - 添加 holdings 表索引（user_id, stock_code, securities_account_id）
   - 添加 bank_transactions 表索引（user_id, transaction_date, bank_account_id）
   - 添加其他相關表的索引
   - 查詢速度可提升數倍到數十倍（視數據量而定）

### UI/UX 改進

#### 個股查詢頁面優化
2. **視覺對齊改進**
   - 「資料來源：Win 投資」對齊到輸入框右側邊界
   - 調整輸入框和按鈕的寬度對齊，統一視覺效果
   - 改進搜尋區域的佈局和對齊方式

#### 使用指南更新
3. **讚賞碼顯示**
   - 在步驟 7「讚賞碼」中添加三張 QR Code 圖片（qrcode.png, qrcode1.png, qrcode2.png）
   - 步驟 7 設置為全寬顯示（col-span-2）
   - 圖片水平排列顯示，提供更多展示空間

### 技術改進

#### 啟動腳本優化
4. **窗口整合與編碼修復**
   - 移除臨時批處理文件方式，使用 PowerShell 隱藏窗口方式打開瀏覽器
   - 整合服務到單一窗口，避免創建多個 cmd.exe 窗口
   - 改進 stop.bat 文件編碼，使用 GBK 編碼確保中文顯示正常

#### 開發體驗改進
5. **日誌輸出優化**
   - 關閉 Vite 代理的請求/回應日誌輸出，保持控制台簡潔
   - 僅保留錯誤日誌輸出，便於調試問題

---

# 版本說明 - vS0002

## 版本信息
- **版本號**: vS0002
- **發布日期**: 2026-01-03

## 更新內容

### 新增功能

#### 歷史收益記錄增強
1. **新增欄位**
   - 「每股股息」欄位（dividend_per_share）：記錄每股分派的股息金額
   - 「持股數量」欄位（share_count）：記錄除權除息日的持股數量
   - 「稅前金額」欄位（pre_tax_amount）：記錄稅前收益金額
   - 「稅額」欄位（tax_amount）：記錄扣繳稅額
   - 「來源」欄位（source）：記錄收益來源
   - 「描述」欄位（description）：記錄詳細描述信息
   - 歷史收益列表完整顯示所有新增欄位

#### 收益類型管理改進
2. **自定義下拉選單**
   - 收益類型輸入改為自定義下拉選單（類似銀行明細選項功能）
   - 收益類型列表儲存在 localStorage，可自由添加和刪除
   - 預設選項：股息、ETF股息、資本利得、除權、除息、除權除息、其他收益
   - 從系統設定頁面移除收益類型管理功能，簡化設定流程

#### 模態窗口改進
3. **居中顯示與拖曳功能**
   - 所有新增/編輯窗口統一改為初始居中顯示
   - 所有模態窗口支援拖曳移動，方便用戶調整位置
   - 改進的窗口包括：
     - 新增收益記錄窗口
     - 新增交易記錄窗口
     - 新增交割記錄窗口
     - 新增銀行帳戶窗口
     - 新增銀行明細窗口

#### 系統診斷功能增強
4. **全面系統檢查**
   - **基礎檢查**：資料庫連接狀態、資料庫文件大小
   - **數據表檢查**：檢查所有主要數據表的記錄數
   - **數據完整性檢查**：資料庫完整性、外鍵完整性、孤立記錄檢查
   - **系統狀態檢查**：錯誤日誌統計、系統日誌總數、管理員帳號數量
   - **數據統計**：各類記錄數量統計
   - 診斷結果分類顯示，使用圖標和顏色標識狀態（成功/警告/錯誤）
   - 顯示診斷摘要統計信息

#### 檔案管理功能完善
5. **數據完整性**
   - 導出存檔功能新增銀行明細（bank_transactions）數據
   - 導入存檔功能新增銀行明細數據導入
   - 確保所有頁面數據都包含在導出/導入功能中

#### 啟動腳本改進
6. **多模式啟動**
   - `start.bat` 支援兩種運行模式：
     - **正常模式**：顯示視窗，方便查看運行狀態
     - **背景模式**：隱藏視窗，在後台運行
   - `start.bat` 使用中文界面，提升本地化體驗
   - 改進後端伺服器啟動檢測邏輯，確保前端在後端就緒後再啟動
   - 新增 `stop.bat`：優雅停止所有服務

### 優化改進

- **用戶體驗優化**
  - 所有新增/編輯模態窗口統一改為居中顯示並支援拖曳
  - 改進窗口拖曳邏輯，避免與表單元素衝突
  - 系統診斷結果顯示優化，使用清晰的狀態圖標和顏色編碼

- **數據處理改進**
  - 歷史收益記錄數據結構擴充，支援更詳細的收益信息記錄
  - 改進收益類型管理，從後端數據庫遷移到前端 localStorage
  - 檔案導出/導入功能完整性檢查，確保所有數據表都包含在內

### 技術改進

- 資料庫結構更新：dividends 表新增多個欄位（dividend_per_share, share_count, source, description）
- 系統診斷 API 增強：提供更全面的系統健康檢查
- 模態窗口組件改進：統一的拖曳功能實現
- 啟動腳本編碼優化：使用 GB2312/GBK 編碼以正確顯示中文
- Vite 代理配置優化：改進錯誤處理和日誌記錄

## 使用說明

### 歷史收益記錄
1. 進入「歷史收益」頁面
2. 點擊「新增收益記錄」按鈕
3. 填寫完整的收益信息，包括每股股息、持股數量、稅前金額、稅額等
4. 在收益類型下拉選單中選擇或新增類型
5. 所有欄位都會顯示在歷史收益列表中

### 收益類型管理
1. 在新增或編輯收益記錄時，點擊收益類型下拉選單
2. 在下拉選單底部的輸入框中輸入新的類型名稱
3. 按 Enter 鍵或點擊「+」按鈕新增類型
4. 點擊類型旁的「×」按鈕可刪除類型
5. 收益類型列表會自動保存在瀏覽器的 localStorage 中

### 模態窗口拖曳
1. 打開任何新增/編輯窗口（收益記錄、交易記錄、交割記錄、銀行帳戶、銀行明細）
2. 窗口會自動居中顯示
3. 在窗口空白區域（非表單元素區域）按住滑鼠左鍵
4. 拖曳滑鼠即可移動窗口位置
5. 釋放滑鼠按鈕完成移動

### 系統診斷
1. 進入「後台管理」→「系統診斷」頁面
2. 點擊「執行診斷」按鈕
3. 系統會執行全面的健康檢查
4. 查看診斷結果，所有檢查項目按類別分組顯示：
   - 基礎檢查：資料庫連接、文件大小等
   - 數據表檢查：各數據表記錄數
   - 數據完整性：完整性檢查、孤立記錄等
   - 系統狀態：錯誤日誌、管理員帳號等
   - 數據統計：各類記錄數量
5. 綠色圖標表示成功，黃色圖標表示警告，紅色圖標表示錯誤
6. 查看診斷摘要了解整體系統狀態

### 啟動腳本使用
1. **正常模式啟動**
   - 執行 `start.bat`
   - 選擇模式 1 或直接按 Enter
   - 服務會在獨立視窗中運行，方便查看運行狀態

2. **背景模式啟動**
   - 執行 `start.bat`
   - 選擇模式 2
   - 服務會在後台隱藏視窗中運行

3. **停止服務**
   - 執行 `stop.bat` 優雅停止所有服務
   - 或在工作管理員中結束 node.exe 程序
   - 或手動關閉服務視窗（僅正常模式）

## 注意事項

- 收益類型列表儲存在瀏覽器的 localStorage 中，不同瀏覽器或設備不會同步
- 模態窗口拖曳功能不會影響表單元素的正常操作（輸入框、下拉選單、按鈕等）
- 背景模式啟動的服務需要在工作管理員或使用 `stop.bat` 來停止
- 系統診斷功能會創建診斷日誌記錄在系統日誌表中
- 如果 `start.bat` 中文顯示亂碼，請在記事本中打開並另存為 ANSI 編碼

---

## 歷史版本

### vS0001-3

#### 個股查詢功能
1. **個股查詢頁面**
   - 可查詢股票代號（如：2330）或股票名稱（如：台積電）
   - 支援進階篩選（市場別、ETF類型、行業）
   - 整合 Win 投資網站，可直接開啟股票詳情頁面
   - 資料來源標註為 Win 投資

#### 使用指南
2. **使用指南頁面**
   - 提供6步初始設定指引
   - 包含快速導航連結，可直接跳轉到對應頁面
   - 首次使用時顯示簡化提示卡片

#### 銀行明細改進
3. **選項欄位功能**
   - 新增「選項」欄位（transaction_category），支援自定義分類
   - 自定義下拉選單，可新增、刪除選項
   - 選項列表儲存在 localStorage，關閉後仍保留
   - 預設選項：集買、集賣、上市櫃劃撥交割款、點精靈、基金配息

4. **摘要格式改進**
   - 銀行明細摘要格式改進，僅顯示股票名稱（不再顯示交易類型和股票代碼）
   - Excel 匯出包含選項欄位

#### 交割記錄改進
5. **狀態自動判斷**
   - 交割記錄狀態自動判斷：根據交割日期自動設定為「已交割」或「未交割」
   - 銀行明細自動生成邏輯改進，每筆交易生成單獨的明細條目

#### 快捷功能擴充
6. **儀表版快捷功能**
   - 新增更多快捷功能項目：個股查詢、使用指南、證券帳戶、系統設定
   - 新增篩選分類：查詢/指南、系統設定

#### 一鍵安裝與啟動
7. **批次檔**
   - `setup.bat`：一鍵安裝依賴並建置（給安裝/更新時使用）
   - `start.bat`：一鍵啟動伺服器並開啟瀏覽器（給一般使用者）

### vS0001-2

#### 系統設定 - 檔案管理功能
1. **導出存檔**
   - 可導出完整系統備份為JSON格式
   - 包含內容：系統設定、幣別設定、交易記錄、證券帳戶、銀行帳戶、交割記錄、歷史收益、庫存管理等

2. **載入存檔(覆蓋)**
   - 可從JSON檔案載入完整備份並還原所有數據
   - 自動處理ID映射，確保數據關聯正確性

3. **導出庫存股票資料**
   - 導出當前庫存股票資料到Excel格式

4. **導出已實現損益資料**
   - 導出已實現損益交易記錄到Excel格式
