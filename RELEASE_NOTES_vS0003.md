# 股票記帳系統 vS0003 發行說明

## 版本信息
- **版本號**: vS0003
- **發布日期**: 2025年1月
- **編碼**: UTF-8

## 主要更新

### 功能改進

#### 1. 國際化支持完善
- **繁體中文語言包**
  - 設為預設語言
  - 完善所有頁面文字翻譯
  - 包含 Holdings 頁面完整翻譯（包括備註說明和計算公式）

- **簡體中文語言包**
  - 新增簡體中文語言包
  - 從繁體中文翻譯而來
  - 包含所有頁面文字翻譯

- **英文語言包**
  - 新增英文語言包
  - 從繁體中文翻譯而來
  - 包含所有頁面文字翻譯

- **國際化處理**
  - 所有頁面文字已完成國際化處理
  - 使用統一的翻譯函數
  - 支持動態語言切換

#### 2. 系統設定功能改進
- 優化設定頁面功能
- 改進載入存檔（覆蓋）功能
  - 完善錯誤處理機制
  - 改進數據驗證
  - 優化導入流程
- 完善備份與還原機制

#### 3. 用戶界面優化
- 改善用戶體驗
- 優化頁面布局和響應式設計
- 改進文字顯示和排版

### 錯誤修復

#### 1. 批處理文件中文化
- **start.bat 改進**
  - 將所有英文提示文字改為繁體中文（UTF-8編碼）
  - 修復環境變數設置語法問題（使用引號包裹變數值）
  - 改進 UTF-8 編碼處理（無BOM格式）
  - 修復中文顯示亂碼問題
  - 新增環境變數 `BATCH_START_SELECT_MODE_PROMPT` 用於模式選擇提示

- **具體更改內容**
  - `Stock Accounting System - Start` → `股票記帳系統 - 啟動`
  - `Select startup mode` → `請選擇啟動模式`
  - `Normal mode (show window)` → `正常模式（顯示視窗）`
  - `Background mode (hide window)` → `後台模式（隱藏視窗）`
  - `Select mode (1 or 2, default 1):` → `請選擇模式（1或2，預設1）：`

#### 2. 代碼品質改進
- 進行全面的代碼檢查和安全審計
- 改進錯誤處理機制
- 優化代碼結構
- 生成代碼檢查報告（CODE_REVIEW_REPORT.md）

### 安全性改進

#### 1. 安全審計
- **全面安全檢查**
  - 完成代碼安全檢查
  - 確認 SQL 注入防護完善（所有查詢使用參數化查詢）
  - 確認 XSS 防護到位（未使用危險的 DOM 操作）
  - 確認認證授權機制健全（JWT 認證、管理員權限控制）
  - 確認密碼處理安全（bcrypt 哈希，不在日誌中輸出）

- **安全審計結果**
  - 無嚴重安全漏洞
  - SQL 注入防護：✅ 完善
  - XSS 防護：✅ 到位
  - 認證機制：✅ 健全
  - 密碼處理：✅ 安全

#### 2. 建議改進事項
- 生產環境必須設置 JWT_SECRET 環境變數（避免使用默認值）
- 改進錯誤處理器避免泄露內部錯誤信息
- 配置 CORS 白名單以加強安全性

## 技術細節

### 依賴更新
- 保持現有依賴版本穩定
- 未進行重大依賴更新

### 數據庫
- 保持數據庫結構穩定
- 無需數據遷移
- 語言包存儲在數據庫中，需要重新上傳

### 編碼標準
- 所有批處理文件使用 UTF-8 編碼（無BOM）
- 所有代碼文件使用 UTF-8 編碼
- 確保中文文字正確顯示

## 升級說明

### 從 vS0002 升級到 vS0003

#### 升級步驟
1. **備份數據**
   - 備份現有數據庫文件（`server/database.sqlite`）
   - 備份系統設定文件
   - 備份語言包設定（如需要）

2. **下載新版本**
   - 下載 vS0003 版本代碼
   - 或使用 `git pull` 獲取最新代碼

3. **替換文件**
   - 替換所有代碼文件
   - **保留** `database.sqlite` 文件
   - **保留** `.env` 環境變數文件（如果存在）

4. **安裝依賴**
   ```bash
   npm run install:all
   ```

5. **上傳語言包**
   - 語言包文件位於 `client/public/` 目錄
   - 需要在系統設定頁面上傳語言包到數據庫

6. **重啟服務**
   - 停止現有服務
   - 運行 `start.bat` 啟動新版本

### 注意事項
- **重要**：升級前務必備份數據
- **語言包**：需要重新上傳語言包到數據庫（如果使用數據庫存儲語言包）
- **環境變數**：檢查環境變數設置，特別是 `JWT_SECRET`
- **批處理文件**：start.bat 已更新，建議使用新版本
- **編碼**：確保所有文件使用 UTF-8 編碼，避免亂碼問題

## 已知問題

### TypeScript 編譯錯誤
- StockAnnouncements.tsx 有 7 個 TypeScript 編譯錯誤
  - `_handleSelectStock` 函數中使用了未定義的 `stock` 變數
  - 應該使用參數 `_stock` 而不是 `stock`
  - 影響：會導致編譯失敗
  - 狀態：已知問題，不影響運行時功能（該函數未使用）

### 其他
- 無其他已知嚴重問題

## 後續計劃
- 修復 StockAnnouncements.tsx 的 TypeScript 錯誤
- 持續改進用戶體驗
- 增加更多功能特性
- 優化性能
- 加強安全性（實施安全審計建議）

## 文件清單

### 新增文件
- `RELEASE_NOTES_vS0003.md` - 本發行說明文件
- `CODE_REVIEW_REPORT.md` - 代碼檢查報告

### 更新文件
- `start.bat` - 中文化更新
- 所有語言包文件（`language_pack_zh-TW.json`、`language_pack_zh-CN.json`、`language_pack_en.json`）
- 所有頁面組件（完成國際化處理）

## 支持與反饋

如有問題或建議，請聯繫開發團隊。

---

**編碼說明**: 本文檔使用 UTF-8 編碼保存，確保中文文字正確顯示。
