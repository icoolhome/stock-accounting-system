# 更新日誌

## vS0002 (2026-01-03)

### 新增功能
- **歷史收益記錄增強**
  - 新增「每股股息」欄位（dividend_per_share）
  - 新增「持股數量」欄位（share_count）
  - 新增「稅前金額」欄位（pre_tax_amount）
  - 新增「稅額」欄位（tax_amount）
  - 新增「來源」欄位（source）
  - 新增「描述」欄位（description）
  - 歷史收益列表顯示所有新增欄位

- **收益類型管理改進**
  - 收益類型輸入改為自定義下拉選單（類似銀行明細選項功能）
  - 收益類型列表儲存在 localStorage，可自由添加和刪除
  - 預設選項：股息、ETF股息、資本利得、除權、除息、除權除息、其他收益
  - 從系統設定頁面移除收益類型管理功能

- **模態窗口改進**
  - 新增收益記錄窗口：初始居中顯示，支援拖曳移動
  - 新增交易記錄窗口：初始居中顯示，支援拖曳移動
  - 新增交割記錄窗口：初始居中顯示，支援拖曳移動
  - 新增銀行帳戶窗口：初始居中顯示，支援拖曳移動
  - 新增銀行明細窗口：初始居中顯示，支援拖曳移動
  - 所有模態窗口支援自由拖曳，提升用戶體驗

- **系統診斷功能增強**
  - 新增基礎檢查：資料庫連接、資料庫文件大小
  - 新增數據表檢查：檢查所有主要數據表的記錄數
  - 新增數據完整性檢查：資料庫完整性、外鍵完整性、孤立記錄檢查
  - 新增系統狀態檢查：錯誤日誌統計、系統日誌總數、管理員帳號數量
  - 新增數據統計：各類記錄數量統計
  - 診斷結果分類顯示，使用圖標和顏色標識狀態（成功/警告/錯誤）
  - 顯示診斷摘要統計信息

- **檔案管理功能完善**
  - 導出存檔功能新增銀行明細（bank_transactions）數據
  - 導入存檔功能新增銀行明細數據導入
  - 確保所有頁面數據都包含在導出/導入功能中

- **啟動腳本改進**
  - `start.bat` 支援兩種運行模式：正常模式（顯示視窗）和背景模式（隱藏視窗）
  - `start.bat` 使用中文界面，提升本地化體驗
  - 改進後端伺服器啟動檢測邏輯，確保前端在後端就緒後再啟動
  - 新增 `stop.bat`：優雅停止所有服務

### 優化改進
- **用戶體驗優化**
  - 所有新增/編輯模態窗口統一改為居中顯示並支援拖曳
  - 改進窗口拖曳邏輯，避免與表單元素衝突
  - 系統診斷結果顯示優化，使用清晰的狀態圖標和顏色編碼

- **數據處理改進**
  - 歷史收益記錄數據結構擴充，支援更詳細的收益信息記錄
  - 改進收益類型管理，從後端數據庫遷移到前端 localStorage
  - 檔案導出/導入功能完整性檢查，確保所有數據表都包含在內

### 技術改進
- 資料庫結構更新：dividends 表新增多個欄位（dividend_per_share, share_count, source, description）
- 系統診斷 API 增強：提供更全面的系統健康檢查
- 模態窗口組件改進：統一的拖曳功能實現
- 啟動腳本編碼優化：使用 GB2312/GBK 編碼以正確顯示中文
- Vite 代理配置優化：改進錯誤處理和日誌記錄

## vS0001-3 (2026-01-XX)

### 新增功能
- **個股查詢功能**
  - 新增「個股查詢」頁面，可查詢股票代號或名稱
  - 支援進階篩選（市場別、ETF類型、行業）
  - 整合 Win 投資網站，可直接開啟股票詳情頁面
  - 資料來源標註為 Win 投資

- **使用指南**
  - 新增「使用指南」頁面，提供6步初始設定指引
  - 包含快速導航連結，可直接跳轉到對應頁面
  - 首次使用時顯示簡化提示卡片

- **銀行明細改進**
  - 新增「選項」欄位（transaction_category），支援自定義分類
  - 自定義下拉選單，可新增、刪除選項
  - 選項列表儲存在 localStorage，關閉後仍保留
  - 銀行明細摘要格式改進，僅顯示股票名稱（不再顯示交易類型和股票代碼）
  - Excel 匯出包含選項欄位

- **交割記錄改進**
  - 交割記錄狀態自動判斷：根據交割日期自動設定為「已交割」或「未交割」
  - 銀行明細自動生成邏輯改進，每筆交易生成單獨的明細條目

- **快捷功能擴充**
  - 儀表版新增更多快捷功能項目：個股查詢、使用指南、證券帳戶、系統設定
  - 新增篩選分類：查詢/指南、系統設定

- **一鍵安裝與啟動**
  - 新增 `setup.bat`：一鍵安裝依賴並建置（給安裝/更新時使用）
  - 新增 `start.bat`：一鍵啟動伺服器並開啟瀏覽器（給一般使用者）

### 優化改進
- **用戶體驗優化**
  - 展開/折疊按鈕樣式改進（改為黑色 ▼/▲ 符號）
  - 輸入框寬度調整，個股查詢頁面輸入框寬度減半
  - 導航菜單順序調整，使用指南移到個股查詢前面

- **數據處理改進**
  - 改進銀行明細自動生成邏輯，支援多筆交易分別生成明細
  - 優化交割記錄與銀行明細的關聯邏輯

### 技術改進
- 新增股票查詢相關 API（/api/stocks/:code/detail）
- 資料庫結構更新，新增 transaction_category 欄位
- 改進錯誤處理和數據驗證

## vS0001-2 (2026-01-XX)

### 新增功能
- **系統設定 - 檔案管理功能**
  - 新增「導出存檔」功能：可導出完整系統備份（包含系統設定、幣別設定、交易記錄、證券帳戶、銀行帳戶、交割記錄、歷史收益、庫存管理等所有數據）
  - 新增「載入存檔(覆蓋)」功能：可從JSON檔案載入完整備份並還原所有數據
  - 新增「導出庫存股票資料」功能：導出當前庫存股票資料到Excel
  - 新增「導出已實現損益資料」功能：導出已實現損益交易記錄到Excel

### 優化改進
- **檔案管理性能優化**
  - 優化導入存檔功能，減少重複API調用，提升導入效率
  - 改進證券帳戶和銀行帳戶ID映射邏輯，確保數據關聯正確性

### 說明文字更新
- 更新檔案管理頁面說明文字，將「股票資料」改為「交易記錄」，更準確反映實際導出/導入內容

### 技術改進
- 優化導入過程中的變數作用域管理
- 改進錯誤處理和日誌記錄




