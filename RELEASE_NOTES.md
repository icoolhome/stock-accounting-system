# Release Notes

## 最新版本：vS0005

### 版本信息
- **版本號**: vS0005
- **發布日期**: 2026-01-08

### 🎯 主要更新

#### ✨ 功能改進

1. **國內股票庫存明細持有成本顯示優化**
   - 持有成本自動四捨五入到整數顯示
   - 每一行明細的持有成本正確顯示為整數（無小數點）
   - 小計和總計的持有成本也四捨五入為整數
   - 後端計算邏輯優化，確保精度處理正確

2. **使用指南增強**
   - 新增第7步驟：讚賞碼區域
   - 在「感謝您的使用，如有任何問題歡迎聯繫我們」右邊添加 email 連結
   - Email：icoolhome001@gmail.com（可點擊發送郵件）
   - 優化讚賞碼區域的視覺呈現

3. **Node.js 中文支援改進**
   - 所有 Node.js 腳本添加 UTF-8 編碼支援
   - 確保中文輸出正確顯示
   - 改進 `setup.js`、`start-node.js`、`stop-node.js` 的中文顯示
   - 所有子進程執行時自動設置 UTF-8 編碼

4. **桌面捷徑建立改進**
   - 改為提示用戶手動建立桌面捷徑
   - 提供詳細的手動建立說明（兩種方法）
   - 改善用戶體驗，避免自動建立失敗的問題

#### 🐛 Bug 修復

1. **持有成本計算精度問題**
   - 修復國內股票庫存明細中持有成本顯示小數點的問題
   - 修復累加計算時的浮點數精度誤差
   - 確保所有持有成本相關顯示都為整數

2. **後端持有成本計算**
   - 修復 `/api/holdings/details` API 中持有成本未正確四捨五入的問題
   - 改進現股、融資、融券的持有成本計算邏輯
   - 使用 `Math.round()` 確保返回整數

#### 🔧 技術改進

1. **前端數據格式化**
   - 新增 `formatHoldingCost` 函數，統一處理持有成本格式化
   - 改進 `formatTotalHoldingCost` 函數，確保總計正確四捨五入
   - 加強字符串和數字類型的處理

2. **後端計算邏輯**
   - 改進持有成本計算，避免浮點數誤差
   - 使用 `floorTo2Decimals()` 處理中間計算
   - 最後統一使用 `Math.round()` 四捨五入到整數

### 📝 使用說明

#### 持有成本顯示
- 國內股票庫存明細中，所有持有成本都會顯示為整數
- 每一行明細、小計、總計都自動四捨五入

#### 使用指南
- 進入「使用指南」頁面查看完整的7步設定指引
- 第7步驟包含讚賞碼和聯絡資訊
- 可直接點擊 email 連結發送郵件

#### 手動建立桌面捷徑
1. 在檔案總管中找到對應的 `.bat` 檔案
2. 方法一：右鍵 → 「傳送到」→「桌面 (建立捷徑)」
3. 方法二：按住 Alt 鍵，拖曳檔案到桌面

### ⚠️ 升級注意事項

- 本次更新主要針對顯示和計算邏輯優化，不影響數據結構
- 建議重新執行 `setup-node.bat` 以確保所有依賴和編譯文件都是最新版本
- 首次使用或升級後，請清除瀏覽器緩存（Ctrl + F5）以確保顯示正確

---

## 📚 詳細版本說明

vS0005 的完整更新記錄請查看：
- [RELEASE_vS0005.md](./RELEASE_vS0005.md) - 詳細版本說明
- [GITHUB_RELEASE_vS0005.md](./GITHUB_RELEASE_vS0005.md) - GitHub Release 說明

---

## 歷史版本

### vS0001-3 (2026-01-XX)

## 版本信息
- **版本號**: vS0001-3
- **發布日期**: 2026-01-XX

## 更新內容

### ✨ 新增功能

#### 個股查詢功能
- 新增「個股查詢」頁面，可查詢股票代號或名稱
- 支援進階篩選（市場別、ETF類型、行業）
- 整合 Win 投資網站，可直接開啟股票詳情頁面
- 資料來源標註為 Win 投資

#### 使用指南
- 新增「使用指南」頁面，提供6步初始設定指引
- 包含快速導航連結，可直接跳轉到對應頁面
- 首次使用時顯示簡化提示卡片

#### 銀行明細改進
- 新增「選項」欄位（transaction_category），支援自定義分類
- 自定義下拉選單，可新增、刪除選項
- 選項列表儲存在 localStorage，關閉後仍保留
- 銀行明細摘要格式改進，僅顯示股票名稱（不再顯示交易類型和股票代碼）
- Excel 匯出包含選項欄位

#### 交割記錄改進
- 交割記錄狀態自動判斷：根據交割日期自動設定為「已交割」或「未交割」
- 銀行明細自動生成邏輯改進，每筆交易生成單獨的明細條目

#### 快捷功能擴充
- 儀表版新增更多快捷功能項目：個股查詢、使用指南、證券帳戶、系統設定
- 新增篩選分類：查詢/指南、系統設定

#### 一鍵安裝與啟動
- 新增 `setup.bat`：一鍵安裝依賴並建置（給安裝/更新時使用）
- 新增 `start.bat`：一鍵啟動伺服器並開啟瀏覽器（給一般使用者）

### 🚀 優化改進

- **用戶體驗優化**
  - 展開/折疊按鈕樣式改進（改為黑色 ▼/▲ 符號）
  - 輸入框寬度調整，個股查詢頁面輸入框寬度減半
  - 導航菜單順序調整，使用指南移到個股查詢前面

- **數據處理改進**
  - 改進銀行明細自動生成邏輯，支援多筆交易分別生成明細
  - 優化交割記錄與銀行明細的關聯邏輯

### 🛠️ 技術改進

- 新增股票查詢相關 API（/api/stocks/:code/detail）
- 資料庫結構更新，新增 transaction_category 欄位
- 改進錯誤處理和數據驗證

## 使用說明

### 個股查詢
1. 進入「個股查詢」頁面
2. 輸入股票代號（如：2330）或股票名稱（如：台積電）
3. 點擊「搜尋」或按 Enter 鍵
4. 系統會在新視窗開啟 Win 投資網站的股票詳情頁面

### 使用指南
1. 進入「使用指南」頁面查看完整的6步初始設定指引
2. 每個步驟提供「前往」按鈕，可直接跳轉到對應頁面
3. 首次使用時會在個股查詢頁面顯示簡化提示卡片

### 銀行明細選項
1. 進入「銀行帳戶」→「新增銀行明細」
2. 在「選項」下拉選單中選擇或新增分類
3. 可透過下拉選單內的輸入框新增選項
4. 可透過選項旁的「×」按鈕刪除選項

### 一鍵安裝與啟動
1. **安裝/更新時**：執行 `setup.bat` 安裝所有依賴並建置專案
2. **啟動系統**：執行 `start.bat` 啟動伺服器並自動開啟瀏覽器

## ⚠️ 注意事項

- 銀行明細選項列表儲存在瀏覽器的 localStorage 中
- 交割記錄狀態會根據交割日期自動判斷，編輯時可手動調整
- 個股查詢功能需要網路連線以開啟 Win 投資網站

## 📝 詳細更新記錄

詳細的更新記錄請參考：
- [CHANGELOG.md](./CHANGELOG.md) - 完整的變更日誌
- [README_VERSION.md](./README_VERSION.md) - 版本說明文件

---

## 歷史版本

### vS0001-2

#### 系統設定 - 檔案管理功能
1. **導出存檔**
   - 可導出完整系統備份為JSON格式
   - 包含內容：系統設定、幣別設定、交易記錄、證券帳戶、銀行帳戶、交割記錄、歷史收益、庫存管理等

2. **載入存檔(覆蓋)**
   - 可從JSON檔案載入完整備份並還原所有數據
   - 自動處理ID映射，確保數據關聯正確性

3. **導出庫存股票資料**
   - 導出當前庫存股票資料到Excel格式

4. **導出已實現損益資料**
   - 導出已實現損益交易記錄到Excel格式
