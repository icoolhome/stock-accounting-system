# Release Notes - vS0005

## 版本信息
- **版本號**: vS0005
- **發布日期**: 2026-01-08

---

## 🎯 主要更新

### ✨ 功能改進

#### 1. 國內股票庫存明細持有成本顯示優化

**問題修復**：
- 修復持有成本顯示小數點的問題（如：`62254.99` → `62255`）
- 修復累加計算時的浮點數精度誤差

**改進內容**：
- ✅ 每一行明細的持有成本自動四捨五入到整數顯示
- ✅ 小計和總計的持有成本也四捨五入為整數
- ✅ 後端計算邏輯優化，確保精度處理正確
- ✅ 前端格式化函數改進，支援字符串和數字輸入

**技術細節**：
- 後端使用 `Math.round()` 確保持有成本為整數
- 前端使用 `formatHoldingCost` 統一處理顯示
- 累加計算時每個值都先四捨五入，避免精度誤差

#### 2. 使用指南增強

**新增功能**：
- ✅ 新增第7步驟：讚賞碼區域
- ✅ 在「感謝您的使用，如有任何問題歡迎聯繫我們」右邊添加 email 連結
- ✅ Email：**icoolhome001@gmail.com**（可點擊發送郵件）
- ✅ 優化讚賞碼區域的視覺呈現（橙色主題）

**使用方式**：
- 進入「使用指南」頁面即可看到第7步驟
- 可直接點擊 email 連結發送郵件聯繫

#### 3. Node.js 中文支援改進

**改進內容**：
- ✅ 所有 Node.js 腳本添加 UTF-8 編碼支援
- ✅ 確保中文輸出正確顯示（無亂碼）
- ✅ 改進 `setup.js`、`start-node.js`、`stop-node.js` 的中文顯示
- ✅ 所有子進程執行時自動設置 UTF-8 編碼環境變數

**影響範圍**：
- 安裝腳本的中文提示
- 啟動/停止腳本的中文日誌
- 所有執行過程中的中文輸出

#### 4. 桌面捷徑建立改進

**改進內容**：
- ✅ 改為提示用戶手動建立桌面捷徑
- ✅ 提供詳細的手動建立說明（兩種方法）
- ✅ 改善用戶體驗，避免自動建立失敗的問題

**建立方法**：
1. **方法一**：右鍵檔案 → 「傳送到」→「桌面 (建立捷徑)」
2. **方法二**：按住 Alt 鍵，拖曳檔案到桌面

---

### 🐛 Bug 修復

#### 1. 持有成本計算精度問題

**問題描述**：
- 國內股票庫存明細中持有成本顯示為 `62254.99` 而非 `62255`
- 累加計算時產生浮點數精度誤差

**修復內容**：
- ✅ 後端 API `/api/holdings/details` 返回整數
- ✅ 前端累加時每個值都先四捨五入
- ✅ 格式化函數確保最終顯示為整數

#### 2. 後端持有成本計算

**修復內容**：
- ✅ 現股、融資、融券的持有成本都使用 `Math.round()` 四捨五入
- ✅ 改進 `priceQty` 和 `fee` 的計算精度處理
- ✅ 使用 `floorTo2Decimals()` 處理中間計算，避免精度誤差

---

### 🔧 技術改進

#### 前端改進

1. **數據格式化函數**
   - 新增 `formatHoldingCost` 函數
   - 改進 `formatTotalHoldingCost` 函數
   - 支援字符串和數字輸入類型

2. **累加邏輯優化**
   - 使用獨立變數累加持有成本
   - 每個值都先四捨五入再累加
   - 累加完成後再次四捨五入確保正確

#### 後端改進

1. **計算邏輯優化**
   - 使用 `floorTo2Decimals()` 處理中間計算
   - 最終結果使用 `Math.round()` 四捨五入
   - 確保所有持有成本相關計算都返回整數

2. **編碼支援**
   - 所有腳本添加 UTF-8 編碼設置
   - 子進程執行時自動設置編碼環境變數

---

## 📋 詳細更新清單

### 新增功能
- [x] 使用指南第7步驟（讚賞碼區域）
- [x] Email 聯絡連結（icoolhome001@gmail.com）
- [x] 持有成本整數顯示功能

### 功能改進
- [x] 持有成本計算精度處理
- [x] Node.js 中文輸出支援
- [x] 桌面捷徑建立方式改進
- [x] 使用指南視覺優化

### Bug 修復
- [x] 持有成本顯示小數點問題
- [x] 累加計算浮點數精度誤差
- [x] 後端持有成本計算未四捨五入

### 技術改進
- [x] 前端格式化函數改進
- [x] 後端計算邏輯優化
- [x] UTF-8 編碼支援完善

---

## 📝 使用說明

### 持有成本顯示
- 國內股票庫存明細中，所有持有成本都會顯示為整數
- 每一行明細、小計、總計都自動四捨五入
- 例如：`62254.99` → `62255`

### 使用指南
1. 進入「使用指南」頁面
2. 查看完整的7步設定指引
3. 第7步驟包含讚賞碼和聯絡資訊
4. 可直接點擊 email 連結發送郵件

### 手動建立桌面捷徑

**方法一：使用「傳送到」**
1. 在檔案總管中找到目標 `.bat` 檔案（如 `start-node.bat`）
2. 在檔案上按右鍵
3. 選擇「傳送到」→「桌面 (建立捷徑)」
4. 桌面上的捷徑會自動建立
5. 在捷徑上按右鍵 → 選擇「重新命名」→ 改為想要的名稱

**方法二：使用快捷鍵**
1. 在檔案總管中找到目標 `.bat` 檔案
2. 按住 Alt 鍵
3. 拖曳檔案到桌面
4. 系統會自動建立捷徑

---

## ⚠️ 升級注意事項

### 升級前準備
- 建議先備份現有資料（使用系統設定 → 導出存檔功能）
- 確認當前系統運行正常

### 升級步驟
1. 停止當前運行的服務（執行 `stop-node.bat`）
2. 執行 `setup-node.bat` 更新系統
3. 重新啟動服務（執行 `start-node.bat`）
4. 清除瀏覽器緩存（Ctrl + F5）

### 升級後檢查
- ✅ 確認持有成本顯示為整數（無小數點）
- ✅ 確認使用指南第7步驟正常顯示
- ✅ 確認 email 連結可以正常點擊
- ✅ 確認所有中文輸出正常顯示（無亂碼）

---

## 📞 技術支援

如有任何問題，歡迎聯繫：
- **Email**: icoolhome001@gmail.com

---

## 📚 相關文件

- [安裝說明.md](./安裝說明.md) - 完整的安裝與使用指南
- [README.md](./README.md) - 專案說明文件
- [CHANGELOG.md](./CHANGELOG.md) - 完整的變更日誌

---

## 🔄 版本歷史

### vS0005 (2026-01-08)
- 持有成本顯示優化
- 使用指南增強（第7步驟）
- Node.js 中文支援改進
- 桌面捷徑建立改進

### vS0001-3 (2026-01-XX)
- 個股查詢功能
- 使用指南（6步）
- 銀行明細改進
- 交割記錄改進

### vS0001-2 (2026-01-XX)
- 系統設定檔案管理功能
- 導出/載入存檔
- Excel 匯出功能

---

**感謝您的使用！** 🎉



